function submitChannel() {
	fetch('http://localhost:3000/creators', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
		},
	})
}

function newEl(type, attrs={}) {
	const el = document.createElement(type);
	for (let attr in attrs) {
		const value = attrs[attr];
		if (attr == 'innerText') el.innerText = value;
		else el.setAttribute(attr, value);
	}
	return el;
}

async function loadCreators() {
	const res = await fetch('http://localhost:3000/creators');
	const creators = await res.json();

	const listTeams = document.querySelector('.table table .table__body');

	listTeams.innerHTML = '';

	let teamPosition = 0

	console.log(creators);

	creators.forEach(creator => {
		const card = newEl('tr');

		teamPosition++

		let over0 = 0
		let over1 = 0
		let over2 = 0
		let over3 = 0
		let over4 = 0
		let under0 = 0
		let under1 = 0
		let under2 = 0
		let under3 = 0
		let under4 = 0

		let domesticLeague = []
		let domesticLeagueFlag = false

		let euroTurnaments = []
		let euroTurnamentsFlag = false

		let otherTurnaments = []
		let otherTurnamentsFlag = false

		for (let i = 0; i < creator.table.length; i++) {
			const pattern = /[^0-9]/g;

			if (creator.table[i] == "ENGLAND\nPremier League\nStandings" || creator.table[i] == "SPAIN\nLaLiga\nStandings") {
				domesticLeagueFlag = true
				euroTurnamentsFlag = false
				otherTurnamentsFlag = false
				continue
			} else if (creator.table[i].includes("EUROPE")) {
				domesticLeagueFlag = false
				euroTurnamentsFlag = true
				otherTurnamentsFlag = false
				continue
			} else if (creator.table[i].slice(0, 1).match(pattern)) {
				domesticLeagueFlag = false
				euroTurnamentsFlag = false
				otherTurnamentsFlag = true
				continue
			}

			if(domesticLeagueFlag) {
				domesticLeague.push(creator.table[i])
			} else if (euroTurnamentsFlag) {
				euroTurnaments.push(creator.table[i])
			} else if (otherTurnamentsFlag) {
				otherTurnaments.push(creator.table[i])
			}
		}

		const rounds = document.getElementById('rounds').value;
		const numberOfMatches = rounds !='' ? rounds : domesticLeague.length;

		const teamMatches = newEl('span', {innerText: `(${numberOfMatches})`});
		// const title = newEl('td', {innerText: `${creator.team}`});
		const title = newEl('td', {innerText: `${teamPosition}. ${creator.team}`});

		title.appendChild(teamMatches);

		for (let i = 0; i < numberOfMatches; i ++) {
			const array = domesticLeague[i].split(/\r\n|\n\r|\n|\r/);
			const goalsSum = parseInt(array[3]) + parseInt(array[4])

			if (goalsSum == 0) {
				under0++
				under1++
				under2++
				under3++
				under4++
			} else if (goalsSum == 1) {
				over0++
				under1++
				under2++
				under3++
				under4++
			} else if (goalsSum == 2) {
				over0++
				over1++
				under2++
				under3++
				under4++
			} else if (goalsSum == 3) {
				over0++
				over1++
				over2++
				under3++
				under4++
			} else if (goalsSum == 4) {
				over0++
				over1++
				over2++
				over3++
				under4++
			} else if (goalsSum > 4) {
				over0++
				over1++
				over2++
				over3++
				over4++
			}
		}

		const percentSumOver0 = over0/numberOfMatches*100;
		const percentSumOver1 = over1/numberOfMatches*100;
		const percentSumOver2 = over2/numberOfMatches*100;
		const percentSumOver3 = over3/numberOfMatches*100;
		const percentSumOver4 = over4/numberOfMatches*100;

		const percentSumUnder0 = under0/numberOfMatches*100;
		const percentSumUnder1 = under1/numberOfMatches*100;
		const percentSumUnder2 = under2/numberOfMatches*100;
		const percentSumUnder3 = under3/numberOfMatches*100;
		const percentSumUnder4 = under4/numberOfMatches*100;

		const percentOver0 = newEl('td', {innerText: parseFloat(percentSumOver0).toFixed(1) + '%'});
		const percentOver1 = newEl('td', {innerText: parseFloat(percentSumOver1).toFixed(1) + '%'});
		const percentOver2 = newEl('td', {innerText: parseFloat(percentSumOver2).toFixed(1) + '%'});
		const percentOver3 = newEl('td', {innerText: parseFloat(percentSumOver3).toFixed(1) + '%'});
		const percentOver4 = newEl('td', {innerText: parseFloat(percentSumOver4).toFixed(1) + '%'});

		const percentUnder0 = newEl('td', {innerText: parseFloat(percentSumUnder0).toFixed(1) + '%'});
		const percentUnder1 = newEl('td', {innerText: parseFloat(percentSumUnder1).toFixed(1) + '%'});
		const percentUnder2 = newEl('td', {innerText: parseFloat(percentSumUnder2).toFixed(1) + '%'});
		const percentUnder3 = newEl('td', {innerText: parseFloat(percentSumUnder3).toFixed(1) + '%'});
		const percentUnder4 = newEl('td', {innerText: parseFloat(percentSumUnder4).toFixed(1) + '%'});

		card.appendChild(title);

		card.appendChild(percentOver0);
		card.appendChild(percentOver1);
		card.appendChild(percentOver2);
		card.appendChild(percentOver3);
		card.appendChild(percentOver4);

		card.appendChild(percentUnder0);
		card.appendChild(percentUnder1);
		card.appendChild(percentUnder2);
		card.appendChild(percentUnder3);
		card.appendChild(percentUnder4);

		listTeams.appendChild(card);
	})
}

